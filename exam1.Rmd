---
title: "exam1"
author: "Mathias Kold"
date: "2024-04-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Exam 1 - OLS and heteroskedasticity

Look at the following model for bank employees wage:
$$log(salary)=\beta_0+\beta_1educ+\beta_2log(salbegin)+\beta_3male+\beta_4 minority+u$$
where salary is yearly wage (in 1000 US dollars), educ is education measured in number of years, salbegin is the starting salary (in 1000 US dollars) for the person's first position in the same bank, male is a dummy variable for gender, minority is one dummy variable indicating whether one belongs to a minority.

## 1 - Estimate the model using OLS. Comment on the output and interpret the results
```{r}
options(scipen = 999)
library(readr)
data1 <- read_csv("data1.csv")
model <- lm(log(salary) ~ educ + log(salbegin) + male + minority, data = data1)
summary(model)
```

From the estimated model it can be seen that the education variable has a value of 0.02327 which means that one extra year of education will raise the salary by approximately 2.3%. The male variable has a value 0.04816 which means that being a man will raise your salary by approximately 4.8%. The minority variable has a value of -0.04237 which means that minorities approximately will have a 4.2% lower salary than people who are not minorities. The salbegin variable have a different interpretation because it is in log form. It has a value of 0.82180 which means that an increase of 1% in your starting salary will make your salary approximately 0.82% higher.

The intercept is 0.84868 which is the value of the dependent variable, in this case salary, when all other variables have a value of 0. So in this case 0.84868 is the expected value of the salary for a person with zero education, without a starting salary and someone who is not a male or a minority.

It can also be seen that all the variables are statistically significant at a 5% significance level due to p-values < 0.05 but only education and log(salbegin) are statistically significant at a 1% significance level. 

## 2 - Perform graphical model checking.
```{r}
plot(model)
```
The residual vs fitted model shows if the residuals have non-linear patterns. If they are equally spread around a horizontal line without any patterns it indicates that the residuals does not have non-linear patterns. From the plot it can be seen that the spread is quite equal around the horizontal red line, although a few outliers exists, which indicates a linear pattern.

The Q-Q residuals plot shows if the residuals are normally distributed. If the residuals fit the dotted line they are normally distributed. In this case, the residuals fit the dotted line except in the last quantiles where they deviate a bit from the dotted line. This could indicate that the residuals are approximately normally distributed although not perfectly normally distributed.

The scale-location plot shows if homoskedasticity exists within the residuals. If the residuals are spread equally around the predictors, the model fulfills the assumption of homoskedasticity. 

## 3 - Test for heteroskedasticity using the Breusch-Pagan test and the special edition of the White test.
```{r}
r=residuals(model)
res = r^2
summary(lm(res~educ + log(salbegin) + male + minority, data = data1))
```
Because the p-value is under 0.05 we reject the null hypothesis meaning that there is heteroskedasticity in the model.

We can now calculate the LM test, where we have 474 observations and $R^2=0.1231$:
```{r}
LM = 0.1231*474
LM
```
We can then calculate the p-value of chi-square $\chi^2_k$:
```{r}
1-pchisq(LM,4)
```


```{r}
library(lmtest)
bptest(model)

```


## 4 - Calculate robust standard errors for the model and compare with the results in question 1.
```{r}

```


## 5 - Test the hypothesis $H_0:\beta_2 = 1$ against the alternative $H_1: \beta_2 \neq 1$.
$\beta_2$ is the estimate for the starting salary's effect on the the yearly salary, so when we want to test the null hypothesis $H_0:\beta_2 = 1$ it means that the starting salary has an effect on the yearly salary. (MAYBE COMMENT ON WHAT KIND OF EFFECT!).

To test our null hypothesis against the alternative hypothesis we use the t-statistics, which is given by:
$$t_{{\hat\beta}_j}=\frac{\hat{\beta_j}-1}{se(\hat{\beta_j})}$$
We will perform a two-side test, so the decision rule will be $|t_{{\hat\beta}_j}|>c$, meaning that the null hypothesis will be rejected if the absolute value of t-statistics is greater than the critical value.

To perform the test we use our estimate $\hat{\beta_2}$ from 1.1.
```{r}
bhat2 <- 0.82180
se_bhat2 <- 0.03603

t_stat <- (bhat2 - 1) / se_bhat2
t_stat
```

Then we need to calculate the critical values for the two-sided test:
```{r}
alpha <- 0.05
c <- qt(1-alpha/2, 469)
c
```
```{r}
abs(t_stat)>c
```


We can see that the absolute value of the t-statistic is greater than the critical value at a 5% significance level, meaning that we reject the null hypothesis, so we instead accept the alternative hypothesis saying that the starting salary does have a statistically significant effect on the yearly salary.

Another way to test the null hypothesis is by calculating the p-value. The definition of the p-value is the probability of obtaining a t-statistic more or at least as extreme than the one observed in the sample. We use R to calculate the p-value in the following way:
```{r}
pval <- 2*pt(-abs(t_stat), 469)
pval
```

So at a 5% significance level we can then also with the p-value reject the null hypothesis, further confirming the rejecting from the t-statistics before. 

## 6 - Test the hypothesis $H_0: \beta_3 = \beta_4 = 0$

## 7 - Estimate the model using FGLS and comment on the results.

## 8 - Has the FGLS estimation taken into account all the heteroskedasticity?
